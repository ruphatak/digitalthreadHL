<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>BMW - Blockchain View</title>
    <meta name="viewport" content="width=device-width, initial-scale=1  maximum-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="HandheldFriendly" content="True">

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <!-- CSS  -->
    <link rel="stylesheet" href="../javascripts/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../stylesheets/materialize.min.css">
    <link rel="stylesheet" href="../stylesheets/normalize.css">
    <link rel="stylesheet" href="../stylesheets/style.css">
    <!-- materialize icon -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Magnific Popup core CSS file -->
    <link rel="stylesheet" href="../javascripts/Magnific-Popup-master/dist/magnific-popup.css">
    <script src="../javascripts//jquery.min.js"></script>
    <!-- <script src="../javascripts//web3.js"></script>
<script src="../javascripts//query_bc.js"></script> -->
</head>

<body id="homepage" onload="restapicall();">
    <!-- BEGIN PRELOADING -->
    <div class="preloading">
        <div class="wrap-preload">
            <div class="cssload-loader"></div>
        </div>
    </div>
    <!-- END PRELOADING -->
    <!-- HEADER -->
    <header id="header">
        <div class="nav-wrapper container">
            <div class="header-logo">
                <a href="#!" class="nav-logo">
                    <img src="../img/BMW_Logo.png" />
                </a>
            </div>
            <div class="pg_title">Status</div>
            <div class="header-menu-button">
                <a href="#" data-activates="nav-mobile" class="button-collapse">
                    <div class="cst-btn-menu">
                        <i class="fa fa-bars" aria-hidden="true"></i>
                    </div>
                </a>
            </div>
        </div>
    </header>
    <!-- END HEADER -->
    <!-- SIDE NAV -->
    <nav>
        <ul id="nav-mobile" class="side-nav">
            <li class="profil">
                <img src="../img/profile.jpg" alt="profile">
                <h2>Achary</h2>
                <h6>Admin</h6>
            </li>
            <!-- <li>
        <a href="dealer_home.html"><i class="fa fa-home" aria-hidden="true"></i>Home</a>
    </li> -->
            <li>
                <a href="fm/fm_home.html">
                    <i class="fa fa-user" aria-hidden="true"></i>Fleet Manager</a>
            </li>
             <li>
                <a href="dealer/dealer_home.html">
                    <i class="fa fa-user" aria-hidden="true"></i>Dealer</a>
            </li>
            <!--  <li>
        <a href="oemcommunication.html"><i class="fa fa-car" aria-hidden="true"></i>OEM Communication</a>
    </li>
     <li>
          <a href="dl_prc.html"><i class="fa fa-user" aria-hidden="true"></i>Parts Recall</a>
     </li> -->
            <li>
                <a href="index.html">
                    <i class="fa fa-lock" aria-hidden="true"></i>Logout</a>
            </li>
        </ul>
    </nav>
    <!-- END SIDE NAV -->
    <!-- TOP MENU-->

    <div id="page-content" class="section news" style="min-height: 1000px;">
        <div class="container">
            <div class="row row-title">
                <div class="col s12">

                      <div class="btn back_btn" style="float: left;">
                        <a href="javascript:history.back()">Back</a>
                     </div>  
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="main-timeline" id="bctimeline">
                        <div id="test2">

                        </div>




                    </div>
                    <!-- <div class="row-team">
                    <table class="responsive-table centered highlight">
                        <thead>
                            <tr>
                                <th>Sl.no</th>
                                <th>Claim No</th>
                                <th>Part Name</th>
                                <th>Production Batch No</th>
                                <th>Comments</th>
                            </tr>
                        </thead>

                        <tbody id="test2">
                             <tr>
                                <td>1</td>
                                <td>Air Bag</td>
                                <td>PB_2014_AB234234</td>
                                <td>Air Bag produce in the production badge was found faulty.</td>
                                <td> <a href="ps_com1.html" class="btn btn-primary m-t-15 waves-effect">View</a></td>
                            </tr>

                        </tbody>
                    </table>

                </div>
                     -->
                </div>

                <!-- <div class="btn transparent cta_btn">
                      <a class="waves-effect waves-light" href="fm_status.html" style="width:100%;">More Details</a>
                   </div> -->
            </div>

        </div>
    </div>


    <!-- END TOP MENU-->

    <!-- Modal Structure -->
    <div id="service_popup" class="modal">
        <div class="modal-content">

            <h5 style="padding-top:10px;">Your request is accepted. Vehicle will be diagnosed in the nearby service center.</h5>
        </div>
        <div class="modal-footer">
            <a href="fm_home.html" class=" modal-action modal-close waves-effect  btn transparent" style="width:10%;">OK</a>
        </div>
    </div>


    <!-- FOOTER  -->
    <footer id="footer">
        <div class="container">

            <div class="row copyright text-white">
                2018
                <span>BMW</span>. All rights reserved.
            </div>
        </div>
    </footer>
    <!-- END FOOTER -->
    <!-- Script -->

    <script src="../javascripts//materialize.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.js"></script>
    <!-- Owl carousel -->
    <script src="../javascripts/owlcarousel/owl.carousel.min.js"></script>
    <!-- Magnific Popup core JS file -->
    <script src="../javascripts/Magnific-Popup-master/dist/jquery.magnific-popup.js"></script>
    <!-- Custom script -->
    <script src="../javascripts//custom.js"></script>
    <script src="../javascripts//getdata.js"></script>
    <script src="http://momentjs.com/downloads/moment-with-locales.min.js"></script>
    <!-- <script src="../javascripts//jquery_bc_bmw.js"></script> -->

    <script>




        var VIN = $_GET('VIN');
        if(VIN == null)
        {
            VIN = $_GET('vin');   
        }
        console.log(VIN);

        $(document).ready(function () {
            // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
            $('.modal').modal();

        });
        function restapicall() {
            // queryAllData(VIN);
        }

        //New
        var divId;
        $.ajax({
            // url: 'javascripts//test.json',
            //   url : 'https://trustedservices.mybluemix.net/getPartsAllDtls',
            url: 'https://trustedbservices.mybluemix.net/getAllBMwdata?VIN=' + VIN,
            data: {
                format: 'json'
            },
            error: function () {
                $('#info').html('<p>An error has occurred</p>');
            },
            dataType: 'jsonp',
            success: function (data) {

                var div;
                if (data.length) {
                    processData(data)
                }else{
                    var d = [];
                    d.push(data);
                    processData(d);
                }


            },
            type: 'GET'
        });

        function processData(data) {
            console.log(data);
            for (var i = 0; i < data.length; i++) {
                var day = new Date(data[i].CREATEDDATE);
                var day = new Date(data[i].CREATEDDATE);
                var rdate = moment(day).format('DD/MM/YYYY');
                var rtime = moment(day).format('hh:mm a');
                div = $('<span/>');

                if(data[i].TYPEOFTRANS == "Sent to Service Center")
                {
                    div.append('<div class="timeline"><div class="icon"></div><div class="date-content"><div class="date-outer"><span class="date"><span class="month">' + rdate + '</span><span class="year">' + rtime + '</span></div></div><div class="timeline-content"><a href="fm_bcview.html?VIN='+ data[i].VIN +'" target="_blank"><h3 class="title">' + data[i].TYPEOFTRANS + '</h3><p class="description">VIN No -' + data[i].VIN + ', Status - '+ data[i].STATUS +'</p></a></div></div>');
                }
                else if(data[i].TYPEOFTRANS == "Vehicle Delivered.")
                {
                    div.append('<div class="timeline"><div class="icon"></div><div class="date-content"><div class="date-outer"><span class="date"><span class="month">' + rdate + '</span><span class="year">' + rtime + '</span></div></div><div class="timeline-content"><a href="dealer_bcview.html?VIN='+ data[i].VIN +'" target="_blank"><h3 class="title">' + data[i].TYPEOFTRANS + '</h3><p class="description">VIN No -' + data[i].VIN + ', Status - '+ data[i].STATUS +'</p></a></div></div>');
                }
                else
                {
                    div.append('<div class="timeline"><div class="icon"></div><div class="date-content"><div class="date-outer"><span class="date"><span class="month">' + rdate + '</span><span class="year">' + rtime + '</span></div></div><div class="timeline-content"><h3 class="title">' + data[i].TYPEOFTRANS + '</h3><p class="description">VIN No -' + data[i].VIN + ', Status - '+ data[i].STATUS +'</p></div></div>');
                }

                $('#test2').append(div);
            }
        }


    </script>


</body>

</html>